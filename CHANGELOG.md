# 更新日志 (CHANGELOG)

本文档记录 KatelyaTV 项目的重要更新和功能变更。

## [0.6.0-katelya] - 2025-09-03

### 🎉 新增功能
- 🖱️ **用户界面优化**
  - 在用户菜单中新增"TVBox配置"按钮，提供便捷的配置入口
  - 新增电视图标（Tv）标识，界面更加直观

- 🎬 **跳过控制器增强**
  - 新增片尾倒计时模式选择：支持剩余时间模式和绝对时间模式
  - 剩余时间模式：基于视频剩余时间进行倒计时（推荐）
  - 绝对时间模式：基于视频播放时间进行检测（兼容旧版本）
  - 优化用户界面，提供更清晰的配置说明和帮助文本
  - 优化用户体验，一键访问TVBox配置页面

### 🐛 Bug修复
- 🎯 **选集点击精确性修复**
  - 修复选集界面点击偏移问题，确保点击哪个集数就选择哪个集数
  - 问题根因：SkipController的固定定位面板(bottom-4 right-4)覆盖了选集面板右下角
  - 解决方案：将跳过配置面板移动到左下角(bottom-4 left-4)，避免与选集面板冲突
  - 保持所有跳过功能正常工作，仅调整UI布局避免重叠

### 🔧 重要改进
- 🔓 **TVBox API 认证优化**
  - **重要变更**：TVBox API (`/api/tvbox`) 现已开放无需认证访问
  - 解决 TVBox 客户端无法登录的根本问题
  - 支持直接在 TVBox 应用中使用配置链接，无需预先登录
  - 中间件配置优化，确保其他管理 API 仍受保护

- ☁️ **Cloudflare Pages 部署支持**
  - 修复所有 API 路由的 Edge Runtime 配置问题
  - 重构文件系统访问逻辑，使用 `getConfig()` 替代 `fs.readFileSync`
  - 解决 Cloudflare Pages 部署失败的核心问题
  - 确保生产环境部署稳定性

### 🐛 问题修复
- 修复代码导入排序导致的 ESLint 警告
- 解决 TVBox API 认证导致的访问失败问题
- 优化构建过程，减少开发环境警告

### 📱 使用体验
- TVBox 配置链接可直接在客户端使用
- 支持 JSON 和 Base64 两种配置格式
- 完全兼容 TVBox 及其衍生应用

## [0.5.1] - 2025-09-03

### 🎉 新增功能
- 📺 **TVBox 兼容支持**
  - 新增 TVBox 配置接口，支持标准 JSON 格式配置
  - 提供直观的配置管理界面 (`/config` 页面)
  - 支持 JSON 和 Base64 两种配置格式
  - 内置视频解析接口，支持多种视频平台
  - 完全兼容 TVBox 及其衍生应用
  - 自动同步 KatelyaTV 配置的所有视频源

### 🔧 技术改进
- 新增 `/api/tvbox` API 端点，提供 TVBox 标准配置
- 新增 `/api/parse` 视频解析接口
- 新增 TVBox 配置页面组件，支持动态格式切换
- 添加 CORS 跨域支持，确保 TVBox 应用正常访问
- 完善的错误处理和用户提示
- 新增详细的 TVBox 使用文档

### 🐛 问题修复
- 修复 Cloudflare Pages 部署时的 Suspense 边界问题
- 解决 Next.js 静态生成时的 useSearchParams 错误
- 优化构建配置，确保跨平台部署兼容性

## [0.5.0] - 2025-09-02

### 🎉 新增功能
- ⏭️ **跳过片头片尾功能**
  - 智能检测播放时间是否在跳过区间内
  - 支持手动设置片头、片尾跳过时间段
  - 播放时自动显示跳过按钮，8秒后自动隐藏
  - 每个用户可独立配置，支持跨设备同步
  - 完全兼容所有存储后端（LocalStorage、Redis、D1、Upstash）

### 🔧 技术改进
- 新增 `SkipController` 组件，提供完整的跳过功能界面
- 新增 `SkipSegment` 和 `EpisodeSkipConfig` 数据类型
- 扩展所有存储实现以支持跳过配置 CRUD 操作
- 新增 `/api/skip-configs` API 路由，支持服务端跳过配置管理
- 完善的类型定义和错误处理

### 🌐 部署兼容性
- ✅ **Cloudflare Pages** - Edge Runtime 完全兼容
- ✅ **Docker 部署** - 自动 Runtime 转换，完全兼容
- ✅ **Vercel 部署** - 自动适配，完全兼容
- ✅ **传统服务器** - Node.js Runtime，完全兼容
- ✅ **其他云平台** - 全面支持各种部署环境

### 📚 文档更新
- 更新 README.md，添加跳过功能介绍和使用教程
- 新增 DEPLOYMENT_COMPATIBILITY.md 部署兼容性说明
- 添加功能特性详细描述
- 完善环境变量和配置说明

### 🧪 测试验证
- 新增 `test-docker-compatibility.js` 兼容性测试脚本
- 验证所有 22 个 API 路由的 Edge Runtime 配置
- 确认所有存储后端的跳过配置功能支持

---

## [0.4.0] - 之前版本

### 基础功能
- 🔍 多源聚合搜索
- 📺 高清视频播放
- ⭐ 收藏功能
- 📖 播放历史记录
- 👥 多用户支持
- 🐳 Docker 一键部署
- ☁️ 多平台部署支持
- 🌓 深色模式
- 📱 PWA 支持

---

## 版本说明

### 版本号规则
- **主版本号**：重大功能更新或架构变更
- **次版本号**：新功能添加或重要改进
- **修订版本号**：Bug 修复和小幅优化

### 更新类型说明
- 🎉 **新增功能** - 全新的功能特性
- 🔧 **技术改进** - 代码优化、性能提升、架构改进
- 🌐 **部署兼容性** - 部署方式和环境支持
- 📚 **文档更新** - 文档完善和说明补充
- 🧪 **测试验证** - 测试覆盖和质量保证
- 🐛 **Bug 修复** - 问题修复和稳定性改进
- ⚡ **性能优化** - 响应速度和资源使用优化
- 🎨 **界面改进** - UI/UX 优化和视觉改进

---

## 贡献指南

如果您想为项目贡献代码或反馈问题：

1. **提交 Issue** - 报告 Bug 或提出功能建议
2. **发起 Pull Request** - 贡献代码改进
3. **完善文档** - 帮助改进项目文档
4. **测试反馈** - 在不同环境下测试并反馈

感谢所有贡献者的支持！🙏
